services:
  ryu-controller:
    build: ./ryu-controller
    container_name: ryu-controller
    networks:
      sdn-net:
        ipv4_address: 172.20.0.10
    ports:
      - "8080:8080"
      - "6633:6633"

  mininet-topology:
    build: ./mininet-topology
    container_name: mininet-topology
    depends_on:
      - ryu-controller
    networks:
      sdn-net:
        ipv4_address: 172.20.0.30
    cap_add:
      - NET_ADMIN
    privileged: true
    tty: true
    stdin_open: true
    volumes:
      - /lib/modules:/lib/modules:ro

  qlearning-agent:
    build: ./qlearning-agent
    container_name: qlearning-agent
    depends_on:
      - ryu-controller
    networks:
      sdn-net:
        ipv4_address: 172.20.0.20
    volumes:
      - ./shared:/shared
      - ./configs:/app/configs

  traffic-generator:
    build: ./traffic-generator
    container_name: traffic-generator
    depends_on:
      - mininet-topology
    networks:
      sdn-net:
        ipv4_address: 172.20.0.40
    cap_add:
      - NET_ADMIN
    privileged: true
    volumes:
      - ./shared:/shared

networks:
  sdn-net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/24